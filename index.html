<!DOCTYPE html><html lang="en">
    <head>
      <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
          <meta name="theme-color" content="#0f172a" />
            <link rel="manifest" href="manifest.json" />
              <title>Workout Tracker</title>
                <style>
                    body { font-family: sans-serif; margin: 0; padding: 1rem; background: #f8fafc; color: #0f172a; }
                        h1, h2 { margin-top: 1.5rem; }
                            .section { margin-bottom: 2rem; }
                                input, button, select { margin: 0.25rem 0; padding: 0.5rem; }
                                    .exercise-block { margin: 1rem 0; border: 1px solid #ccc; padding: 0.5rem; background: #fff; }
                                      </style>
                                      </head>
                                      <body>
                                        <h1>üèãÔ∏è Workout Tracker</h1>  <div class="section">
                                            <h2>Create Routine</h2>
                                                <input id="routineName" placeholder="Routine name" />
                                                    <button id="createRoutineBtn" onclick="createRoutine()" disabled>Create</button>
                                                        <div id="newRoutineExercises"></div>
                                                            <button onclick="addExerciseToNewRoutine()">Add Exercise</button>
                                                              </div>  <div class="section">
                                                                  <h2>Saved Routines</h2>
                                                                      <div id="savedRoutinesList"></div>
                                                                            </div>  <div class="section" id="workoutSection" style="display:none;">
                                                                                <h2>Workout in Progress</h2>
                                                                                    <div id="workoutExercises"></div>
                                                                                        <button onclick="saveWorkout()">Finish & Save Workout</button>
    </div>

    <div class="section" id="savedWorkoutsSection">
      <button id="toggleSavedWorkoutsBtn">Show/Hide Saved Workouts</button>
      <h2>My Saved Workouts</h2>
      <div id="savedWorkoutsList" style="display:none;"></div>
    </div>

    <script>
                                                                                              const routinesKey = 'workout_routines';
                                                                                                  const historyKey = 'workout_history';

                                                                                                      function validateRoutineForm() {
                                                                                                        const routineNameInput = document.getElementById('routineName');
                                                                                                        const newRoutineExercisesDiv = document.getElementById('newRoutineExercises');
                                                                                                        const createBtn = document.getElementById('createRoutineBtn');

                                                                                                        const isNameValid = routineNameInput.value.trim() !== '';
                                                                                                        const hasAtLeastOneExercise = newRoutineExercisesDiv.children.length > 0;

                                                                                                        if (isNameValid && hasAtLeastOneExercise) {
                                                                                                          createBtn.disabled = false;
                                                                                                        } else {
                                                                                                          createBtn.disabled = true;
                                                                                                        }
                                                                                                      }

                                                                                                      let currentlyEditingRoutineName = null; // For tracking edit state

                                                                                                      function loadRoutineForEdit(routineName) {
                                                                                                        const routines = JSON.parse(localStorage.getItem(routinesKey) || '{}');
                                                                                                        const routineToEdit = routines[routineName];

                                                                                                        if (!routineToEdit) {
                                                                                                          alert('Error: Routine not found!');
                                                                                                          return;
                                                                                                        }

                                                                                                        document.getElementById('routineName').value = routineName;
                                                                                                        const newRoutineExercisesDiv = document.getElementById('newRoutineExercises');
                                                                                                        newRoutineExercisesDiv.innerHTML = ''; // Clear existing exercise inputs

                                                                                                        routineToEdit.forEach(exerciseName => {
                                                                                                          addExerciseToNewRoutine(exerciseName); // Pass name to prefill
                                                                                                        });

                                                                                                        document.getElementById('createRoutineBtn').textContent = 'Update Routine';
                                                                                                        currentlyEditingRoutineName = routineName;
                                                                                                        validateRoutineForm(); // Update button state
                                                                                                      }

                                                                                                      function loadSavedWorkouts() {
                                                                                                            const savedWorkoutsList = document.getElementById('savedWorkoutsList');
                                                                                                            savedWorkoutsList.innerHTML = ''; // Clear previous content

                                                                                                            const history = JSON.parse(localStorage.getItem(historyKey) || '[]');

                                                                                                            if (!history || history.length === 0) {
                                                                                                              savedWorkoutsList.innerHTML = '<p>No saved workouts yet.</p>';
                                                                                                              return;
                                                                                                            }

                                                                                                            // Iterate in reverse to show most recent workouts first
                                                                                                            for (let i = history.length - 1; i >= 0; i--) {
                                                                                                              const workout = history[i];
                                                                                                              const workoutItem = document.createElement('div');
                                                                                                              workoutItem.className = 'workout-item exercise-block'; // Re-use some styling

                                                                                                              const dateHeading = document.createElement('h3');
                                                                                                              dateHeading.textContent = `Workout Date: ${workout.date}`;
                                                                                                              workoutItem.appendChild(dateHeading);

                                                                                                              // Delete button for the workout
                                                                                                              const deleteBtn = document.createElement('button');
                                                                                                              deleteBtn.textContent = 'Delete Workout';
                                                                                                              // Pass original index before reversing. Since we iterate from history.length - 1 down to 0,
                                                                                                              // the index 'i' is the correct original index.
                                                                                                              deleteBtn.onclick = function() { deleteSavedWorkout(i); };
                                                                                                              deleteBtn.style.marginBottom = '0.5rem'; // Add some spacing
                                                                                                              workoutItem.appendChild(deleteBtn);

                                                                                                              workout.exercises.forEach(exercise => {
                                                                                                                const exerciseDiv = document.createElement('div');
                                                                                                                exerciseDiv.style.marginBottom = '0.5rem';
                                                                                                                const exerciseName = document.createElement('p');
                                                                                                                exerciseName.innerHTML = `<strong>${exercise.name}</strong>`;
                                                                                                                exerciseDiv.appendChild(exerciseName);

                                                                                                                const setsList = document.createElement('ul');
                                                                                                                setsList.style.listStyle = 'none';
                                                                                                                setsList.style.paddingLeft = '1rem';
                                                                                                                exercise.sets.forEach((set, index) => {
                                                                                                                  const setItem = document.createElement('li');
                                                                                                                  setItem.textContent = `Set ${index + 1}: ${set.reps} reps @ ${set.weight} kg`;
                                                                                                                  setsList.appendChild(setItem);
                                                                                                                });
                                                                                                                exerciseDiv.appendChild(setsList);
                                                                                                                workoutItem.appendChild(exerciseDiv);
                                                                                                              });
                                                                                                              savedWorkoutsList.appendChild(workoutItem);
                                                                                                            }
                                                                                                          }

                                                                                                          function deleteSavedWorkout(workoutIndex) {
                                                                                                            if (!confirm('Are you sure you want to delete this workout?')) {
                                                                                                              return;
                                                                                                            }
                                                                                                            const history = JSON.parse(localStorage.getItem(historyKey) || '[]');
                                                                                                            if (workoutIndex >= 0 && workoutIndex < history.length) {
                                                                                                              history.splice(workoutIndex, 1);
                                                                                                              localStorage.setItem(historyKey, JSON.stringify(history));
                                                                                                              loadSavedWorkouts(); // Refresh the list
                                                                                                            } else {
                                                                                                              console.error('Invalid workout index for deletion:', workoutIndex);
                                                                                                            }
                                                                                                          }

                                                                                                      function loadRoutines() {
                                                                                                            const routines = JSON.parse(localStorage.getItem(routinesKey) || '{}'); // TODO: currentlyEditingRoutineName should be reset if this is called.
                                                                                                            const savedListDiv = document.getElementById('savedRoutinesList');
                                                                                                            savedListDiv.innerHTML = ''; // Clear previous entries

                                                                                                            if (Object.keys(routines).length === 0) {
                                                                                                              savedListDiv.innerHTML = '<p>No saved routines yet.</p>';
                                                                                                              return;
                                                                                                            }

                                                                                                            for (const routineName in routines) {
                                                                                                              const routineItemDiv = document.createElement('div');
                                                                                                              routineItemDiv.className = 'routine-item'; // For potential styling
                                                                                                              routineItemDiv.style.marginBottom = '0.5rem';

                                                                                                              const nameSpan = document.createElement('span');
                                                                                                              nameSpan.textContent = routineName;
                                                                                                              nameSpan.style.marginRight = '0.5rem';

                                                                                                              const editBtn = document.createElement('button');
                                                                                                              editBtn.textContent = 'Edit';
                                                                                                              editBtn.onclick = function() { loadRoutineForEdit(routineName); };
                                                                                                              editBtn.style.marginRight = '0.5rem';

                                                                                                              const startBtn = document.createElement('button');
                                                                                                              startBtn.textContent = 'Start Workout';
                                                                                                              startBtn.onclick = function() { startWorkoutFromRoutine(routineName); };

                                                                                                              routineItemDiv.appendChild(nameSpan);
                                                                                                              routineItemDiv.appendChild(editBtn);
                                                                                                              routineItemDiv.appendChild(startBtn);
                                                                                                              savedListDiv.appendChild(routineItemDiv);
                                                                                                            }
                                                                                                          }

                                                                                                                                                                            function createRoutine() {
                                                                                                                                                                                   const nameInput = document.getElementById('routineName');
                                                                                                                                                                                   const name = nameInput.value.trim();
                                                                                                                                                                                   const exercises = [...document.querySelectorAll('.exercise-name')].map(el => el.value.trim()).filter(exName => exName); // Ensure no empty exercise names

                                                                                                                                                                                   if (!name || exercises.length === 0) {
                                                                                                                                                                                     alert('Enter routine name and at least one exercise');
                                                                                                                                                                                     return;
                                                                                                                                                                                   }

                                                                                                                                                                                   const routines = JSON.parse(localStorage.getItem(routinesKey) || '{}');

                                                                                                                                                                                   if (currentlyEditingRoutineName && currentlyEditingRoutineName !== name) {
                                                                                                                                                                                     // If name changed, delete old routine entry
                                                                                                                                                                                     delete routines[currentlyEditingRoutineName];
                                                                                                                                                                                   }
                                                                                                                                                                                   // Add or update the routine
                                                                                                                                                                                   routines[name] = exercises;
                                                                                                                                                                                   localStorage.setItem(routinesKey, JSON.stringify(routines));

                                                                                                                                                                                   alert(currentlyEditingRoutineName ? 'Routine updated!' : 'Routine saved!');

                                                                                                                                                                                   // Reset form and state
                                                                                                                                                                                   nameInput.value = '';
                                                                                                                                                                                   document.getElementById('newRoutineExercises').innerHTML = '';
                                                                                                                                                                                   document.getElementById('createRoutineBtn').textContent = 'Create';
                                                                                                                                                                                   currentlyEditingRoutineName = null;
                                                                                                                                                                                   loadRoutines(); // Refresh the list of routines
                                                                                                                                                                                   validateRoutineForm(); // Reset button state
                                                                                                                                                                                 }

                                                                                                                                                                                                                                     function addExerciseToNewRoutine(exerciseName = '') { // Optional parameter
                                                                                                                                                                                                                                          const routineExercisesContainer = document.getElementById('newRoutineExercises');

                                                                                                                                                                                                                                          const exerciseEntryDiv = document.createElement('div');
                                                                                                                                                                                                                                          exerciseEntryDiv.style.display = 'flex'; // Align items inline
                                                                                                                                                                                                                                          exerciseEntryDiv.style.alignItems = 'center'; // Vertically align items
                                                                                                                                                                                                                                          exerciseEntryDiv.style.marginBottom = '0.25rem'; // Spacing

                                                                                                                                                                                                                                          const input = document.createElement('input');
                                                                                                                                                                                                                                          input.placeholder = 'Exercise name';
                                                                                                                                                                                                                                          input.className = 'exercise-name'; // Crucial for createRoutine()
                                                                                                                                                                                                                                          input.value = exerciseName; // Set value if provided
                                                                                                                                                                                                                                          input.style.marginRight = '0.5rem'; // Space before button

                                                                                                                                                                                                                                          const removeBtn = document.createElement('button');
                                                                                                                                                                                                                                          removeBtn.textContent = 'Remove';
                                                                                                                                                                                                                                          removeBtn.onclick = function() {
                                                                                                                                                                                                                                            this.parentElement.remove();
                                                                                                                                                                                                                                            validateRoutineForm();
                                                                                                                                                                                                                                          };

                                                                                                                                                                                                                                          exerciseEntryDiv.appendChild(input);
                                                                                                                                                                                                                                          exerciseEntryDiv.appendChild(removeBtn);
                                                                                                                                                                                                                                          routineExercisesContainer.appendChild(exerciseEntryDiv);
                                                                                                                                                                                                                                          validateRoutineForm(); // Call after adding
                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                          function startWorkoutFromRoutine(routineName) { // Modified signature
                                                                                                                                                                                                                                                                                            const routines = JSON.parse(localStorage.getItem(routinesKey) || '{}');
                                                                                                                                                                                                                                                                                                  const exercises = routines[routineName] || [];

                                                                                                                                                                                                                                                                                                        const workoutContainer = document.getElementById('workoutExercises');
                                                                                                                                                                                                                                                                                                              workoutContainer.innerHTML = '';

                                                                                                                                                                                                                                                                                                                    exercises.forEach(name => {
                                                                                                                                                                                                                                                                                                                            const block = document.createElement('div');
                                                                                                                                                                                                                                                                                                                                    block.className = 'exercise-block';
                                                                                                                                                                                                                                                                                                                                            block.innerHTML = `<strong>${name}</strong><br/>` +
                                                                                                                                                                                                                                                                                                                                                      [...Array(3)].map((_, i) => `Set ${i+1}: <input type="number" placeholder="Reps" /> reps @ <input type="number" placeholder="Weight" /> kg<br/>`).join('');
                                                                                                                                                                                                                                                                                                                                                              workoutContainer.appendChild(block);
                                                                                                                                                                                                                                                                                                                                                                    });

                                                                                                                                                                                                                                                                                                                                                                          document.getElementById('workoutSection').style.display = 'block';
                                                                                                                                                                                                                                                                                                                                                                              }

                                                                                                                                                                                                                                                                                                                                                                                  function saveWorkout() {
                                                                                                                                                                                                                                                                                                                                                                                        const blocks = document.querySelectorAll('.exercise-block');
                                                                                                                                                                                                                                                                                                                                                                                              const date = new Date().toISOString().split('T')[0];
                                                                                                                                                                                                                                                                                                                                                                                                    const workout = { date, exercises: [] };

                                                                                                                                                                                                                                                                                                                                                                                                          blocks.forEach(block => {
                                                                                                                                                                                                                                                                                                                                                                                                                  const name = block.querySelector('strong').textContent;
                                                                                                                                                                                                                                                                                                                                                                                                                          const inputs = block.querySelectorAll('input');
                                                                                                                                                                                                                                                                                                                                                                                                                                  const sets = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                          for (let i = 0; i < inputs.length; i += 2) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                    sets.push({ reps: Number(inputs[i].value), weight: Number(inputs[i + 1].value) });
                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    workout.exercises.push({ name, sets });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const history = JSON.parse(localStorage.getItem(historyKey) || '[]');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      history.push(workout);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            localStorage.setItem(historyKey, JSON.stringify(history));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  alert('Workout saved!');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        document.getElementById('workoutSection').style.display = 'none';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function toggleSavedWorkoutsDisplay() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const list = document.getElementById('savedWorkoutsList');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  if (list.style.display === 'none' || list.style.display === '') {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    list.style.display = 'block';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    list.style.display = 'none';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                loadRoutines();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                loadSavedWorkouts();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                document.getElementById('toggleSavedWorkoutsBtn').addEventListener('click', toggleSavedWorkoutsDisplay);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                document.getElementById('routineName').addEventListener('input', validateRoutineForm);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                validateRoutineForm(); // Initial check
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </script></body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </html>